<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EnrollEase - Taal High School</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body{
    font-family: 'Poppins', sans-serif;
    background: url('TaalHighSchool.png') no-repeat center center fixed;
    background-size: cover;
    margin:0;
    color: #333;
}
.container{ padding:20px; background: rgba(255,255,255,0.9); margin: 20px auto; max-width:1200px; border-radius:10px; }
h1{ margin-bottom:5px; }
.subtitle{ color:gray; margin-bottom:20px; }

.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
}
.search-box input{
    padding:8px;
    width:260px;
    border-radius:4px;
    border:1px solid #ccc;
}
button{
    padding:8px 14px;
    border:none;
    cursor:pointer;
}
.add-btn{
    background:#3498db;
    color:white;
    border-radius:4px;
}

.logout-btn{
    background:#3498db;
    color:white;
    border-radius:4px;
}

/* TABLE */
table{
    width:100%;
    border-collapse:collapse;
    background:white;
    margin-bottom:30px;
}
th, td{
    padding:12px;
    border-bottom:1px solid #ddd;
    font-size:13px;
}
th{ background:#eef1f5; }
.actions button{ margin-right:5px; border-radius:4px; font-size:12px; }
.edit{ background:#f1c40f; }
.delete{ background:#e74c3c; color:white; }

/* MODAL */
.modal {
    position: fixed;
    top: 0;
    right: -500px;   /* offscreen initially */
    width: 480px;
    height: 100%;    /* full viewport height */
    background: white;
    box-shadow: -2px 0 10px rgba(0,0,0,0.2);
    transition: 0.3s;
    padding: 20px;
    overflow-y: auto;    /* THIS makes it scrollable */
    font-size: 14px;
    z-index: 999;
}

.modal.active{ right:0; }
.modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.modal {
    max-width: 100%;
    box-sizing: border-box;
}

.close{ font-size:20px; cursor:pointer; }

label{ font-size:13px; display:block; margin-top:10px; }
input, select{
    width:100%;
    padding:7px;
    margin-top:4px;
}
.save-btn{
    margin-top:15px;
    width:100%;
    background:#3498db;
    color:white;
    border-radius:4px;
}

/* ============================= */
/* UNIVERSAL RESPONSIVE CSS */
/* ============================= */

/* Make everything scale safely */
html, body {
  width: 100%;
  overflow-x: hidden;
}

/* Flexible images */
img {
  max-width: 100%;
  height: auto;
}

/* Tablets */
@media (max-width: 1024px) {

  .container,
  .form,
  .phone,
  .login-box {
    width: 95% !important;
    max-width: 95% !important;
    margin: 10px auto !important;
  }

  .top-left-images,
  .top-left-images-2 {
    position: static !important;
    flex-direction: row !important;
    justify-content: center;
  }

}

/* Mobile phones */
@media (max-width: 768px) {

  body {
    height: auto !important;
    padding: 10px;
  }

  header {
    flex-direction: column !important;
    text-align: center;
  }

  nav {
    margin-top: 10px;
  }

  .row {
    flex-direction: column !important;
  }

  .address-grid {
    grid-template-columns: 1fr !important;
  }

  .login-box,
  .phone,
  .container,
  .form {
    width: 100% !important;
    padding: 15px !important;
  }

  .hero-content h2 {
    font-size: 24px !important;
  }

}

/* Small phones */
@media (max-width: 480px) {

  h1, h2, h3 {
    font-size: 18px !important;
  }

  button,
  .btn {
    font-size: 14px !important;
    padding: 10px !important;
  }

  input, select {
    font-size: 14px !important;
  }

}

</style>
</head>

<body>

<div class="container">
    <h1>EnrollEase - Taal High School</h1>
    <div class="subtitle">Student Management Records and Alternative Enrollment Form</div>

    <div class="top-bar">
        <div class="search-box">
            <input type="text" id="search" placeholder="Search by name or LRN...">
        </div>
                <button type="button" class="logout-btn" onclick="logout()">
           Log Out
        </button>
        <button class="add-btn" onclick="openModal()">+ New Enrollment</button>
    </div>

    <h2>Junior High School (Grades 7–10)</h2>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>LRN</th>
                <th>Sex</th>
                <th>Age</th>
                <th>Grade Level</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="jhsTable"></tbody>
    </table>

    <h2>Senior High School (Grades 11–12)</h2>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>LRN</th>
                <th>Sex</th>
                <th>Age</th>
                <th>Grade Level</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="shsTable"></tbody>
    </table>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modal-header">
        <h3 id="modalTitle">New Enrollment</h3>
        <span class="close" onclick="closeModal()">✖</span>
    </div>

    <h4>Learner Information</h4>
    <label>LRN *</label>
    <input type="text" id="lrn">
    <label>PSA Certificate</label>
    <input type="text" id="psa">
    <label>Last Name *</label>
    <input type="text" id="lastName">
    <label>First Name *</label>
    <input type="text" id="firstName">
    <label>Middle Name</label>
    <input type="text" id="middleName">
    <label>Extension Name</label>
    <input type="text" id="extName">
    <label>Birthdate *</label>
    <input type="date" id="birthdate" onchange="calculateAge()">
    <label>Age</label>
    <input type="number" id="age" readonly>
    <label>Sex *</label>
    <select id="sex">
        <option>Male</option>
        <option>Female</option>
    </select>
    <label>Place of Birth</label>
    <input type="text" id="birthPlace">
    <label>Mother Tongue</label>
    <input type="text" id="motherTongue">

    <h4>Address</h4>
    <label>House No.</label>
    <input type="text" id="houseNo">
    <label>Street</label>
    <input type="text" id="street">
    <label>Barangay</label>
    <input type="text" id="barangay">
    <label>Municipal/City</label>
    <input type="text" id="city">
    <label>Province</label>
    <input type="text" id="province">
    <label>ZIP Code</label>
    <input type="text" id="zip">

    <h4>Parent's Information</h4>
    <label>Father's Name</label>
    <input type="text" id="fatherName">
    <label>Father's Contact</label>
    <input type="text" id="fatherContact">
    <label>Mother's Name</label>
    <input type="text" id="motherName">
    <label>Mother's Contact</label>
    <input type="text" id="motherContact">
    <label>Guardian's Name</label>
    <input type="text" id="guardianName">
    <label>Guardian's Contact</label>
    <input type="text" id="guardianContact">

    <h4>Grade Level</h4>
    <label>Grade Level *</label>
    <input type="number" id="grade" min="7" max="12" onchange="toggleSHSFields()">

    <!-- Senior High Fields -->
    <div>
        <label>Semester</label>
        <select id="semester">
            <option>1st Semester</option>
            <option>2nd Semester</option>
        </select>
    </div>
    <div>
        <label>Strand</label>
        <input type="text" id="strand">
    </div>

    <!-- Optional Information -->
    <h4>Optional Information</h4>
    <label>Indigenous People</label>
    <select id="ipSelect" onchange="toggleIPText()">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
    </select>
    <input type="text" id="ipText" placeholder="Specify Indigenous Group" style="display:none; margin-top:5px;">

    <label>4P's Household</label>
    <select id="4psSelect" onchange="toggle4PSText()">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
    </select>
    <input type="text" id="4psText" placeholder="Specify 4P's Household" style="display:none; margin-top:5px;">

    <label>Person With Disability (PWD)</label>
    <select id="pwdSelect" onchange="togglePWDSelect()">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
    </select>
    <select id="pwdType" style="display:none; margin-top:5px;">
        <option value="">Select Disability Type</option>
        <option value="Hearing Disabilities">Hearing Disabilities</option>
        <option value="Visual Disabilities">Visual Disabilities</option>
        <option value="Learning Disabilities">Learning Disabilities</option>
        <option value="Intellectual Disabilities">Intellectual Disabilities</option>
    </select>

    <button class="save-btn" onclick="saveStudent()">Save Enrollment</button>
</div>

<script>
let students = JSON.parse(localStorage.getItem("students")) || [];
let editIndex = null;

// Toggle optional fields
function toggleIPText(){document.getElementById("ipText").style.display=document.getElementById("ipSelect").value==="Yes"?"block":"none";}
function toggle4PSText(){document.getElementById("4psText").style.display=document.getElementById("4psSelect").value==="Yes"?"block":"none";}
function togglePWDSelect(){document.getElementById("pwdType").style.display=document.getElementById("pwdSelect").value==="Yes"?"block":"none";}

// Toggle SHS fields based on Grade Level
function toggleSHSFields(){
    const grade = parseInt(document.getElementById("grade").value);
    const semester = document.getElementById("semester").parentElement;
    const strand = document.getElementById("strand").parentElement;
    if(grade>=11){semester.style.display="block";strand.style.display="block";}
    else{semester.style.display="none";strand.style.display="none";document.getElementById("strand").value="";}
}

// Modal functions
function openModal(index=null){
    document.getElementById("modal").classList.add("active");
    if(index!==null){
        editIndex=index;
        const s=students[index];
        document.getElementById("modalTitle").innerText="Edit Enrollment";
        for(const key in s){if(document.getElementById(key)){const el=document.getElementById(key);el.type==="checkbox"?el.checked=s[key]:el.value=s[key];}}
        toggleIPText();toggle4PSText();togglePWDSelect();toggleSHSFields();
    }else{
        editIndex=null;clearForm();document.getElementById("modalTitle").innerText="New Enrollment";
    }
}
function closeModal(){document.getElementById("modal").classList.remove("active");}
function clearForm(){
    const fields=["lrn","psa","lastName","firstName","middleName","extName","birthdate","age","sex","birthPlace","motherTongue","houseNo","street","barangay","city","province","zip","fatherName","fatherContact","motherName","motherContact","guardianName","guardianContact","grade","semester","strand"];
    fields.forEach(f=>{const el=document.getElementById(f);if(el)el.value="";});
    document.getElementById("sex").value="Male";
    document.getElementById("ipSelect").value="No";
    document.getElementById("4psSelect").value="No";
    document.getElementById("pwdSelect").value="No";
    toggleIPText();toggle4PSText();togglePWDSelect();toggleSHSFields();
}

// Calculate age
function calculateAge(){
    const birthdate=new Date(document.getElementById("birthdate").value);
    if(!isNaN(birthdate)){
        const ageDifMs=Date.now()-birthdate.getTime();
        document.getElementById("age").value=Math.abs(new Date(ageDifMs).getUTCFullYear()-1970);
    }
}

// Save student
function saveStudent(){
    const student={
        lrn:document.getElementById("lrn").value,
        psa:document.getElementById("psa").value,
        lastName:document.getElementById("lastName").value,
        firstName:document.getElementById("firstName").value,
        middleName:document.getElementById("middleName").value,
        extName:document.getElementById("extName").value,
        birthdate:document.getElementById("birthdate").value,
        age:document.getElementById("age").value,
        sex:document.getElementById("sex").value,
        birthPlace:document.getElementById("birthPlace").value,
        motherTongue:document.getElementById("motherTongue").value,
        houseNo:document.getElementById("houseNo").value,
        street:document.getElementById("street").value,
        barangay:document.getElementById("barangay").value,
        city:document.getElementById("city").value,
        province:document.getElementById("province").value,
        zip:document.getElementById("zip").value,
        fatherName:document.getElementById("fatherName").value,
        fatherContact:document.getElementById("fatherContact").value,
        motherName:document.getElementById("motherName").value,
        motherContact:document.getElementById("motherContact").value,
        guardianName:document.getElementById("guardianName").value,
        guardianContact:document.getElementById("guardianContact").value,
        grade:parseInt(document.getElementById("grade").value),
        semester:document.getElementById("semester").value,
        strand:document.getElementById("strand").value,
        pwdType:document.getElementById("pwdSelect").value==="Yes"?document.getElementById("pwdType").value:"No",
        ip:document.getElementById("ipSelect").value==="Yes"?document.getElementById("ipText").value:"No",
        "4ps":document.getElementById("4psSelect").value==="Yes"?document.getElementById("4psText").value:"No"
    };
    if(!student.firstName||!student.lastName||!student.lrn){alert("Please fill required fields!");return;}
    if(!/^\d{12}$/.test(student.lrn)){alert("LRN must be 12 digits!");return;}

    if(editIndex!==null) students[editIndex]=student; else students.push(student);
    localStorage.setItem("students",JSON.stringify(students));
    renderTables(); closeModal();

    const url=student.grade>=11?
        "https://enrollease---enrollment-form-default-rtdb.asia-southeast1.firebasedatabase.app/seniors_pre-enrollment_student.json":
        "https://enrollease---enrollment-form-default-rtdb.asia-southeast1.firebasedatabase.app/juniors_pre-enrollment_student.json";
    fetch(url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(student)})
    .then(res=>res.json()).then(data=>console.log("Saved to Firebase:",data))
    .catch(err=>console.error("Firebase error:",err));
}

// Delete student
function deleteStudent(index){if(confirm("Delete this record?")){students.splice(index,1);localStorage.setItem("students",JSON.stringify(students));renderTables();}}

// Render tables
function renderTables(filter=""){
    const jhsTable=document.getElementById("jhsTable");
    const shsTable=document.getElementById("shsTable");
    jhsTable.innerHTML=""; shsTable.innerHTML="";
    students.filter(s=>s.firstName.toLowerCase().includes(filter)||s.lastName.toLowerCase().includes(filter)||s.lrn.includes(filter))
    .forEach((s,index)=>{
        const row=`<tr>
            <td>${index+1}</td>
            <td>${s.lastName}, ${s.firstName} ${s.middleName||""} ${s.extName||""}</td>
            <td>${s.lrn}</td>
            <td>${s.sex}</td>
            <td>${s.age}</td>
            <td>${s.grade}</td>
            <td class="actions">
                <button class="edit" onclick="openModal(${index})">Edit</button>
                <button class="delete" onclick="deleteStudent(${index})">Delete</button>
            </td>
        </tr>`;
        if(s.grade>=7&&s.grade<=10) jhsTable.innerHTML+=row;
        else if(s.grade>=11&&s.grade<=12) shsTable.innerHTML+=row;
    });
}

// Search
document.getElementById("search").addEventListener("input",e=>renderTables(e.target.value.toLowerCase()));

// Initial render
renderTables();

function logout(){
    window.location.href = "newlogin.html";
}
</script>
</body>
</html>
